<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';
             script-src 'self';
             style-src 'self' 'unsafe-inline';
             connect-src 'self';
             img-src 'self' data: blob:;
             media-src 'self' blob:;">
  <meta name="theme-color" content="#722F37">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <title>BitClutch Signer</title>
  <style>
    /* ── Reset & Base ── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #FAF5EF;
      --surface: #FFFFFF;
      --surface-hover: #F5F0EA;
      --text: #1A1A1A;
      --text-secondary: #6B6B6B;
      --text-muted: #9B9B9B;
      --accent: #722F37;
      --accent-hover: #5A1A22;
      --gold: #C5A55A;
      --border: #E5E0DA;
      --border-light: #F0EBE5;
      --danger: #C0392B;
      --success: #27AE60;
      --input-bg: #F5F0EA;
      --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --mono: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    }

    @media (prefers-color-scheme: dark) {
      :root:not(.light) {
        --bg: #0F0F0F;
        --surface: #1A1A1A;
        --surface-hover: #252525;
        --text: #FAF5EF;
        --text-secondary: #A0A0A0;
        --text-muted: #6B6B6B;
        --border: #2A2A2A;
        --border-light: #222222;
        --input-bg: #1A1A1A;
      }
    }
    :root.dark {
      --bg: #0F0F0F;
      --surface: #1A1A1A;
      --surface-hover: #252525;
      --text: #FAF5EF;
      --text-secondary: #A0A0A0;
      --text-muted: #6B6B6B;
      --border: #2A2A2A;
      --border-light: #222222;
      --input-bg: #1A1A1A;
    }

    html, body {
      height: 100%;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      overflow: hidden;
    }

    /* ── App Shell ── */
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    /* ── Header ── */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
    }
    .header-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }
    .header-title span:first-child { color: var(--text-muted); }
    .header-title span:last-child { color: var(--accent); }
    .header-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 10px;
      background: var(--surface-hover);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }

    /* ── Screen Container ── */
    .screen-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      -webkit-overflow-scrolling: touch;
    }

    /* ── Tab Bar ── */
    .tab-bar {
      display: flex;
      border-top: 1px solid var(--border);
      background: var(--surface);
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
    .tab-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 10px 0;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 10px;
      font-family: var(--font);
      cursor: pointer;
      transition: color 0.2s;
      min-height: 52px;
    }
    .tab-btn.active { color: var(--accent); }
    .tab-btn svg { width: 22px; height: 22px; }

    /* ── Common Components ── */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      font-family: var(--font);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      min-height: 48px;
      width: 100%;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      background: var(--accent);
      color: #FAF5EF;
    }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-secondary {
      background: var(--surface-hover);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-danger {
      background: var(--danger);
      color: #FAF5EF;
    }
    .btn-success {
      background: var(--success);
      color: #FAF5EF;
    }
    .input {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 16px;
      font-family: var(--font);
      background: var(--input-bg);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }
    .input:focus { border-color: var(--accent); }
    .input::placeholder { color: var(--text-muted); }
    .label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .text-muted { color: var(--text-muted); font-size: 13px; }
    .text-center { text-align: center; }
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }
    .mt-20 { margin-top: 20px; }
    .mb-12 { margin-bottom: 12px; }
    .gap-12 { display: flex; flex-direction: column; gap: 12px; }

    /* ── Progress Bar ── */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin: 8px 0;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 3px;
      transition: width 0.3s;
    }

    /* ── Dice Grid ── */
    .dice-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin: 16px 0;
    }
    .dice-btn {
      aspect-ratio: 1;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--surface);
      color: var(--text);
      font-size: 20px;
      font-weight: 700;
      font-family: var(--font);
      cursor: pointer;
      transition: all 0.15s;
      min-height: 48px;
    }
    .dice-btn:active {
      background: var(--accent);
      color: #FAF5EF;
      border-color: var(--accent);
      transform: scale(0.92);
    }

    /* ── Coin Buttons ── */
    .coin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }
    .coin-btn {
      padding: 20px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--surface);
      color: var(--text);
      font-size: 18px;
      font-weight: 700;
      font-family: var(--font);
      cursor: pointer;
      transition: all 0.15s;
      min-height: 60px;
    }
    .coin-btn:active {
      background: var(--accent);
      color: #FAF5EF;
      border-color: var(--accent);
      transform: scale(0.96);
    }

    /* ── Mnemonic Grid ── */
    .mnemonic-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin: 12px 0;
    }
    .mnemonic-word {
      padding: 8px 10px;
      background: var(--surface-hover);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      font-size: 13px;
      font-family: var(--mono);
    }
    .mnemonic-word .num {
      color: var(--text-muted);
      margin-right: 6px;
      font-size: 11px;
    }

    /* ── QR ── */
    .qr-container {
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .qr-container canvas, .qr-container img {
      border-radius: 12px;
      max-width: 260px;
    }

    /* ── Video (camera) ── */
    .camera-container {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      overflow: hidden;
      border-radius: 12px;
      background: #000;
      margin: 12px 0;
    }
    .camera-container video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ── TX Confirmation ── */
    .tx-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border-light);
      font-size: 14px;
    }
    .tx-label { color: var(--text-secondary); flex-shrink: 0; min-width: 72px; }
    .tx-value { font-weight: 600; font-family: var(--mono); font-size: 13px; }
    .tx-address {
      font-family: var(--mono);
      font-size: 12px;
      word-break: break-all;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* ── Security Banner ── */
    .security-banner {
      background: var(--surface-hover);
      border: 1px solid var(--border);
      border-left: 3px solid var(--gold);
      border-radius: 8px;
      padding: 12px 14px;
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* ── Entropy display ── */
    .entropy-display {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text-muted);
      word-break: break-all;
      padding: 10px;
      background: var(--surface-hover);
      border-radius: 8px;
      margin-top: 8px;
      max-height: 60px;
      overflow: hidden;
    }

    /* ── Hidden ── */
    .hidden { display: none !important; }

    /* ── Network Warning Banner ── */
    .network-banner {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      font-size: 12px;
      font-weight: 700;
      line-height: 1.4;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    .network-banner svg { flex-shrink: 0; }
    .network-banner .banner-icon { display: none; }
    /* DANGER state (online) */
    .network-banner.online {
      background: #DC2626; color: #FFFFFF; border-bottom: 2px solid #991B1B;
    }
    .network-banner.online .icon-danger { display: block; }
    .network-banner.online .icon-safe { display: none; }
    /* WARN state (online, no key yet) */
    .network-banner.warn {
      background: #D97706; color: #FFFFFF; border-bottom: 2px solid #92400E;
    }
    .network-banner.warn .icon-warn { display: block; }
    .network-banner.warn .icon-danger { display: none; }
    .network-banner.warn .icon-safe { display: none; }
    /* SAFE state (offline) */
    .network-banner.offline {
      background: #15803D; color: #F0FDF4; border-bottom: 2px solid #166534;
    }
    .network-banner.offline .icon-safe { display: block; }
    .network-banner.offline .icon-danger { display: none; }
    .network-banner.offline .icon-warn { display: none; }
    @media (prefers-color-scheme: dark) {
      :root:not(.light) .network-banner.online { background: #991B1B; color: #FEE2E2; border-bottom-color: #7F1D1D; }
      :root:not(.light) .network-banner.warn { background: #78350F; color: #FEF3C7; border-bottom-color: #92400E; }
      :root:not(.light) .network-banner.offline { background: #14532D; color: #DCFCE7; border-bottom-color: #166534; }
    }
    .dark .network-banner.online { background: #991B1B; color: #FEE2E2; border-bottom-color: #7F1D1D; }
    .dark .network-banner.warn { background: #78350F; color: #FEF3C7; border-bottom-color: #92400E; }
    .dark .network-banner.offline { background: #14532D; color: #DCFCE7; border-bottom-color: #166534; }
    @keyframes pulse-danger { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }
    .network-banner.online { animation: pulse-danger 1.5s ease-in-out infinite; }

    /* ── Import Word Grid ── */
    .import-toggle { display: flex; gap: 6px; margin-bottom: 10px; }
    .import-toggle .toggle-btn {
      flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px;
      background: var(--surface); color: var(--text-muted); font-size: 13px;
      font-weight: 500; cursor: pointer; text-align: center; transition: all 0.15s;
    }
    .import-toggle .toggle-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
    .lang-dropdown { position: relative; width: 100%; max-width: 200px; user-select: none; }
    .lang-dropdown-trigger {
      display: flex; align-items: center; justify-content: space-between;
      padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px;
      background: var(--surface); color: var(--text-primary); font-size: 13px;
      font-weight: 500; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s;
    }
    .lang-dropdown-trigger:hover { border-color: var(--accent); }
    .lang-dropdown-trigger.open { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59,130,246,0.15); border-radius: 8px 8px 0 0; }
    .lang-dropdown-arrow {
      width: 16px; height: 16px; transition: transform 0.2s;
      fill: none; stroke: var(--text-muted); stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
    }
    .lang-dropdown-trigger.open .lang-dropdown-arrow { transform: rotate(180deg); }
    .lang-dropdown-menu {
      display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 50;
      max-height: 320px; overflow-y: auto; border: 1px solid var(--accent);
      border-top: none; border-radius: 0 0 8px 8px;
      background: var(--surface); box-shadow: 0 8px 24px rgba(0,0,0,0.18);
    }
    .lang-dropdown-menu.show { display: block; }
    .lang-dropdown-item {
      padding: 9px 12px; font-size: 13px; cursor: pointer;
      color: var(--text-secondary); transition: background 0.1s, color 0.1s;
      display: flex; align-items: center; justify-content: space-between;
    }
    .lang-dropdown-item:hover { background: var(--surface-hover); color: var(--text-primary); }
    .lang-dropdown-item.selected { color: var(--accent); font-weight: 600; }
    .lang-dropdown-item .check-icon { width: 14px; height: 14px; stroke: var(--accent); fill: none; stroke-width: 2.5; }
    .lang-dropdown-item:last-child { border-radius: 0 0 8px 8px; }

    /* ── Custom Modal ── */
    .modal-overlay {
      display: none; position: fixed; inset: 0; z-index: 200;
      background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
      align-items: center; justify-content: center; padding: 24px;
    }
    .modal-overlay.show { display: flex; animation: fadeIn 0.15s ease-out; }
    .modal-box {
      background: var(--bg); border: 1px solid var(--border); border-radius: 16px;
      padding: 28px 24px 20px; max-width: 340px; width: 100%;
      box-shadow: 0 16px 48px rgba(0,0,0,0.3); text-align: center;
    }
    .modal-icon { margin-bottom: 12px; }
    .modal-icon svg { width: 40px; height: 40px; }
    .modal-title { font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
    .modal-body { font-size: 13px; color: var(--text-muted); line-height: 1.5; margin-bottom: 20px; }
    .modal-actions { display: flex; gap: 8px; }
    .modal-actions .btn { flex: 1; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .import-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 12px; }
    .import-cell { position: relative; }
    .import-cell label { display: flex; align-items: center; gap: 3px; }
    .import-num { font-size: 11px; color: var(--text-muted); min-width: 18px; text-align: right; }
    .import-word {
      width: 100%; font-family: var(--mono); font-size: 13px;
      padding: 7px 6px; border: 1px solid var(--border); border-radius: 6px;
      background: var(--surface); color: var(--text); outline: none; box-sizing: border-box;
    }
    .import-word:focus { border-color: var(--accent); }
    .import-word.valid { border-color: var(--success); }
    .import-suggest {
      position: absolute; top: 100%; left: 0; right: 0; z-index: 10;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 0 0 8px 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      max-height: 140px; overflow-y: auto; display: none;
    }
    .import-suggest.show { display: block; }
    .import-suggest-item {
      padding: 7px 10px; cursor: pointer; font-size: 13px;
      font-family: var(--mono); color: var(--text);
    }
    .import-suggest-item:active, .import-suggest-item.active { background: var(--surface-hover); }

    /* ── Guide Accordion ── */
    .guide-section { margin-bottom: 8px; }
    .guide-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      min-height: 44px;
      transition: border-color 0.2s;
    }
    .guide-header:active { border-color: var(--accent); }
    .guide-header .badge-detected {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 8px;
      background: var(--success);
      color: #fff;
      font-weight: 600;
    }
    .guide-header .chevron {
      transition: transform 0.2s;
      color: var(--text-muted);
    }
    .guide-header.open .chevron { transform: rotate(180deg); }
    .guide-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .guide-body-inner {
      padding: 12px 14px;
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    .guide-body-inner ol {
      margin: 8px 0;
      padding-left: 20px;
    }
    .guide-body-inner ol li {
      margin-bottom: 6px;
    }
    .guide-body-inner strong {
      color: var(--text);
    }
    .guide-body-inner code {
      background: var(--surface-hover);
      padding: 1px 5px;
      border-radius: 4px;
      font-family: var(--mono);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <span>Bit</span><span>Clutch Signer</span>
      </div>
      <div id="lock-badge" class="header-badge">Locked</div>
    </div>

    <!-- Network Warning Banner (real-time detection) -->
    <div id="network-banner" class="network-banner offline">
      <svg class="banner-icon icon-danger" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"/>
      </svg>
      <svg class="banner-icon icon-warn" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"/>
      </svg>
      <svg class="banner-icon icon-safe" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><polyline points="9 12 11.5 14.5 16 9.5"/>
      </svg>
      <span id="banner-text">Offline &mdash; safe to use.</span>
    </div>

    <!-- Screen Container (app.js renders here) -->
    <div id="screen" class="screen-container">
      <!-- Rendered by app.js -->
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="key">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/>
        </svg>
        <span>Key</span>
      </button>
      <button class="tab-btn" data-tab="sign">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/>
        </svg>
        <span>Sign</span>
      </button>
      <button class="tab-btn" data-tab="settings">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span>Settings</span>
      </button>
    </div>
  </div>

  <!-- Custom Modal -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal-box">
      <div id="modal-icon" class="modal-icon"></div>
      <div id="modal-title" class="modal-title"></div>
      <div id="modal-body" class="modal-body"></div>
      <div id="modal-actions" class="modal-actions"></div>
    </div>
  </div>

  <script src="lib/bundle.js"></script>
  <script src="app.js"></script>
</body>
</html>
